---
import Listing from '../layouts/Listing.astro';
import PostCard from '../components/PostCard.astro';
import PostHero from '../components/PostHero.astro';
import PostRowItem from '../components/PostRowItem.astro';
import PostListItem from '../components/PostListItem.astro';
import ViewToggle from '../components/ViewToggle.astro';
import { getAllPosts } from '../utils/posts';

const allPosts = await getAllPosts();

// Filter entries only for magazine layout
const entries = allPosts.filter(post => post.data.type === 'entry');
const heroPost = entries[0];
const popularPosts = entries.slice(1, 5);
const longReadPosts = entries.slice(5);
---

<Listing title="Home">
  <div class="page-header">
    <h1 class="page-title">Recent Posts</h1>
    <ViewToggle />
  </div>

  <!-- Magazine View -->
  <div class="view-magazine">
    <!-- Hero Section -->
    <PostHero post={heroPost} />

    <!-- Most Popular Section -->
    {popularPosts.length > 0 && (
      <section class="section-popular">
        <div class="section-header">
          <h2 class="section-title">Most Popular</h2>
          <a href="/entries/" class="view-all">VIEW ALL â†’</a>
        </div>
        <div class="popular-row">
          {popularPosts.map(post => <PostRowItem post={post} />)}
        </div>
      </section>
    )}

    <!-- Long Reads Section -->
    {longReadPosts.length > 0 && (
      <section class="section-long-reads">
        <h2 class="section-title">Long Reads</h2>
        <div class="long-reads-list">
          {longReadPosts.map(post => <PostListItem post={post} />)}
        </div>
      </section>
    )}
  </div>

  <!-- List View -->
  <div class="view-list">
    <div class="posts-list">
      {allPosts.map(post => <PostCard post={post} />)}
    </div>
  </div>
</Listing>

<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
  }

  .page-header .page-title {
    margin-bottom: 0;
  }

  /* Section styling */
  .section-popular,
  .section-long-reads {
    margin-bottom: var(--spacing-xl);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--border);
  }

  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .section-long-reads .section-title {
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--border);
  }

  .view-all {
    font-size: 0.8rem;
    color: var(--text-muted);
    text-decoration: none;
  }

  .view-all:hover {
    color: var(--accent);
  }

  /* Popular row - horizontal layout */
  .popular-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-xl);
  }

  @media (max-width: 1200px) {
    .popular-row {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-lg);
    }
  }

  @media (max-width: 600px) {
    .popular-row {
      grid-template-columns: 1fr;
    }
  }

  /* View switching */
  .view-magazine,
  .view-list {
    display: none;
  }

  :global(body[data-view="magazine"]) .view-magazine {
    display: block;
  }

  :global(body[data-view="list"]) .view-list {
    display: block;
  }

  /* Default to magazine if no data-view set */
  :global(body:not([data-view])) .view-magazine {
    display: block;
  }
</style>
