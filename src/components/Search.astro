---
---

<div class="search-container" data-pagefind-ui>
  <input
    type="search"
    class="search-input"
    placeholder="Search posts..."
    id="search-input"
    aria-label="Search posts"
  />
  <div id="search-results" class="search-results"></div>
</div>

<script is:inline>
  (async function initSearch() {
    const input = document.getElementById('search-input');
    const results = document.getElementById('search-results');
    if (!input || !results) return;

    try {
      // Dynamically import pagefind - only available after build
      const pagefind = await import('/pagefind/pagefind.js');
      await pagefind.init();

      input.addEventListener('input', async (e) => {
        const query = e.target.value;
        if (!query) {
          results.innerHTML = '';
          return;
        }

        const search = await pagefind.search(query);
        const data = await Promise.all(search.results.slice(0, 10).map((r) => r.data()));

        results.innerHTML = data.map((item) => `
          <a href="${item.url}" class="search-result">
            <h3>${item.meta?.title || 'Untitled'}</h3>
            <p>${item.excerpt}</p>
          </a>
        `).join('');
      });
    } catch (e) {
      // Pagefind not available in dev mode - show message
      results.innerHTML = '<p class="search-dev-notice">Search is available after building the site (npm run build).</p>';
    }
  })();
</script>

<style>
  .search-container {
    max-width: 600px;
    margin: 0 auto;
  }

  .search-results {
    margin-top: var(--spacing-md);
  }

  .search-result {
    display: block;
    padding: var(--spacing-md);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: var(--spacing-sm);
    color: var(--text-primary);
  }

  .search-result:hover {
    border-color: var(--accent);
  }

  .search-result h3 {
    font-size: 1rem;
    margin-bottom: var(--spacing-xs);
  }

  .search-result p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0;
  }

  .search-result mark {
    background: var(--accent-muted);
    color: var(--text-primary);
  }

  .search-dev-notice {
    color: var(--text-secondary);
    font-style: italic;
  }
</style>
